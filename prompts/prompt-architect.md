# Prompt Architecture Guide

## Overview

This guide documents the complete LLM workflow system for structured software development, from initial planning through implementation and enhancement, with comprehensive multi-file documentation system.

## System Architecture

### Core Components

#### 1. Foundation Files

- **`core-rules.txt`**: Universal rules for all LLM interactions
  - Anti-hallucination measures
  - Request type detection (Knowledge/Coding-Workflow/Coding-Ask)
  - Step execution control with context-aware loading
  - Code standards and quality requirements
  - Documentation loading strategy for core docs

#### 2. Template Files

- **`PROJECT-DOCS-TEMPLATES.md`**: Consolidated template for 5 specialized documentation files
  - PROJECT-OVERVIEW.md: Business context and architecture
  - DEVELOPER-GUIDE.md: Setup instructions and workflow
  - CODING-STANDARDS.md: Conventions and patterns
  - CODEBASE-REFERENCE.md: Classes, functions, and code inventory
  - LLM-CONTEXT.md: AI-specific domain context

- **`TASKS-TEMPLATE.md`**: Task management template
  - Status tracking system (`[ ]`, `[⏳]`, `[x]`, `[❌]`, `[⏸️]`)
  - Project overview integration
  - Task lifecycle management

#### 3. Workflow Steps

**Sequential processing steps with context-aware documentation loading:**

- **`step-planning.txt`**: Initial brainstorming and architecture planning
  - Feature analysis and approach exploration
  - Planning file generation in `.claude/custom/planning/`
  - Architecture decision documentation

- **`step-tasks.txt`**: Task breakdown from planning
  - Converts planning into actionable tasks
  - Task file generation in `.claude/custom/tasks/`
  - Progress preservation and change tracking

- **`step-1-context.txt`**: Context gathering and analysis
  - Requires completed planning and tasks files
  - Loads CODING-STANDARDS.md, CODEBASE-REFERENCE.md, DEPENDENCIES-GUIDE.md
  - Codebase pattern analysis and integration point identification

- **`step-2-skeleton.txt`**: Structural framework generation
  - Depends on step-1 context (no additional docs)
  - No implementation logic, structure only
  - Complete typing and documentation

- **`step-3-review.txt`**: Implementation review and validation
  - Depends on step-1 context
  - Loads DEVELOPER-GUIDE.md for testing approach
  - Pattern consistency checking and quality validation

- **`step-4-enhance.txt`**: Extension and optimization
  - Depends on step-1 context (no additional docs)
  - Skeleton enhancement and performance improvements
  - Integration enhancements

- **`step-5-implement.txt`**: Business logic implementation
  - Depends on step-1 context (no additional docs)
  - Convert skeleton methods to working code
  - Implement business logic and data processing

#### 4. Specialized Assistants

- **`step-project-overview.txt`**: Multi-file project documentation creation/update specialist
  - Generates all 5 documentation files in docs/ folder
  - Auto-detects existing files and forces user input for new projects
  - Codebase scanning and analysis with template-based generation
  - Technology stack recommendations and architecture pattern identification

- **`step-method-implement.txt`**: Standalone method implementation
  - Independent implementation without planning/task context
  - Quick method implementation using existing patterns
  - Loads CODEBASE-REFERENCE.md and CODING-STANDARDS.md
  - Reuses existing methods with TODO comments for missing dependencies

## Workflow Logic

### File Organization Strategy

```
.claude/custom/
├── planning/           # Feature planning documents
│   ├── feature-a.md
│   └── feature-b.md
└── tasks/              # Task breakdown files
    ├── feature-a.md    # Mirrors planning filename
    └── feature-b.md

docs/                   # Project documentation (generated by step-project-overview)
├── PROJECT-OVERVIEW.md      # Business context and architecture
├── DEVELOPER-GUIDE.md       # Setup instructions and workflow
├── CODING-STANDARDS.md      # Conventions and patterns
├── CODEBASE-REFERENCE.md    # Classes, functions, and code inventory
└── LLM-CONTEXT.md          # AI-specific domain context
```

### Context Dependencies & Documentation Loading

1. **Planning Phase**: Independent, generates planning files
2. **Task Phase**: Requires planning file, generates tasks file
3. **Context Phase**: Requires both planning and tasks files + loads 3 doc files
4. **Implementation Phases**: All require context from step-1 (inherit doc loading)
5. **Review Phase**: Requires step-1 + loads DEVELOPER-GUIDE.md
6. **Project Overview**: Template-driven generation of all 6 doc files

### Context-Aware Loading Strategy

**Core Documentation (Always Loaded by core-rules.txt):**

- PROJECT-OVERVIEW.md: Tech stack, architecture, business context
- LLM-CONTEXT.md: Domain terminology, business rules, patterns

**Step-Specific Documentation (Load IF NOT already in context):**

- step-1-context: CODING-STANDARDS.md, CODEBASE-REFERENCE.md
- step-3-review: DEVELOPER-GUIDE.md (unique to review)
- step-method-implement: CODEBASE-REFERENCE.md, CODING-STANDARDS.md (independent)
- step-project-overview: All docs for analysis/update (when they exist)

### State Management

- **Progress Preservation**: Completed tasks (`[x]`) never lose status
- **Change Tracking**: New/updated/obsolete tasks clearly marked
- **Status Transitions**: Clear progression from `[ ]` → `[⏳]` → `[x]`
- **Dependency Handling**: Blocked tasks (`[⏸️]`) with clear reasons

## Key Design Principles

### 1. Context Continuity

- Each step builds on previous steps with enforced dependencies
- Context is preserved within chat sessions
- Missing context triggers re-execution prompts with absolute stops
- Context-aware loading prevents redundant file reads

### 2. File Management

- Consistent naming between planning and tasks files
- Auto-detection of existing files with smart update modes
- Template-driven generation with consolidated PROJECT-DOCS-TEMPLATES.md
- Multi-file documentation system with 5 specialized files

### 3. Quality Assurance

- Built-in quality checklists at each step
- Pattern consistency enforcement across all documentation
- Security and performance considerations
- Cross-file consistency validation

### 4. Flexibility

- Can start from any step if dependencies exist
- Supports both new and existing projects
- Handles partial implementations with TODO tracking
- Independent method implementation via step-method-implement
- Request type detection for appropriate workflow selection

## Usage Patterns

### New Feature Development

1. Run `step-project-overview` → Generate/update 5 documentation files
2. Run `step-planning` → Create planning document
3. Run `step-tasks` → Break down into tasks
4. Run `step-1-context` → Gather context + load 2 doc files
5. Run `step-2-skeleton` → Generate structure (inherits step-1 context)
6. Implement manually or with `step-5-implement`

### Existing Project Enhancement

1. Run `step-project-overview` → Update all documentation files
2. Run `step-planning` → Plan enhancements
3. Continue with normal workflow

### Code Review and Optimization

1. Run `step-1-context` → Analyze current state + load coding docs
2. Run `step-3-review` → Review implementation + load developer guide
3. Run `step-4-enhance` → Suggest improvements (inherits step-1 context)

### Quick Method Implementation

1. Run `step-method-implement` → Standalone method implementation
2. No planning/task dependencies required
3. Auto-loads coding standards and codebase reference
4. Reuses existing methods with TODO comments for missing dependencies

### Documentation-First Development

1. Run `step-project-overview` → Establish comprehensive project context
2. All subsequent steps benefit from rich documentation context
3. Context-aware loading prevents redundant file reads within session

## Integration Points

### With Development Tools

- **Direct file editing**: No diff/patch complexity
- **Codebase scanning**: Automatic pattern detection with 5-file documentation system
- **Documentation sync**: Multi-file docs aligned with code via step-project-overview
- **Context-aware loading**: Efficient documentation access without redundancy

### With Project Management

- **Task tracking**: Clear status and progress with template-driven approach
- **Dependency management**: Blocked task handling with absolute stops
- **Change management**: Planning file updates with cross-file consistency
- **Documentation system**: Comprehensive project knowledge base for LLM context

## Error Handling

### Missing Dependencies

- Clear error messages when required files missing with absolute stops
- Forced user workflow to run prerequisite steps
- Auto-detection of available files with template validation
- Context-aware loading prevents unnecessary file reads

### Context Loss

- Session context preservation with documentation loading strategy
- Fallback to file-based context via multi-file documentation system
- Re-execution prompts when needed with step dependency enforcement
- Template-driven recovery with PROJECT-DOCS-TEMPLATES.md

## Best Practices

### For LLM Operators

1. Start with `step-project-overview` to establish documentation system
2. Maintain file naming consistency between planning and tasks
3. Preserve task progress during updates with status tracking
4. Use context checks before implementation steps with absolute stops
5. Leverage context-aware loading to avoid redundant file reads

### For Developers

1. Review generated planning documents and 5-file documentation system
2. Update task status regularly with clear progression markers
3. Keep docs/ folder current via step-project-overview updates
4. Follow established patterns from context analysis and coding standards
5. Provide project descriptions for comprehensive documentation generation

## Extensibility

### Adding New Steps

- Follow context dependency model with step-1 inheritance
- Include quality checklists and absolute stops for missing dependencies
- Provide clear error handling with context-aware loading
- Document integration points with documentation system
- Specify required documentation files with "IF NOT already in context"

### Customizing Templates

- Maintain core structure in PROJECT-DOCS-TEMPLATES.md
- Add project-specific sections while preserving template format
- Keep placeholder conventions for dynamic content generation
- Update related workflow steps to reference new documentation requirements
- Ensure cross-file consistency across all 5 documentation files

### Documentation System Extensions

- Add new documentation files to docs/ folder structure
- Update step-project-overview.txt to include new files in generation
- Modify core-rules.txt if new files need universal loading
- Add context-aware loading patterns to relevant step files
- Maintain template consolidation in PROJECT-DOCS-TEMPLATES.md

This architecture provides a comprehensive, structured approach to LLM-assisted software development with streamlined 5-file documentation system, context-aware loading, and absolute dependency enforcement while maintaining flexibility and quality standards.
